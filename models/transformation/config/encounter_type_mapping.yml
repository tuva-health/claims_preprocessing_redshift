version: 2

models:
    - name: encounter_type_mapping
      description: Mapping of institutional and profession claims at the claim line level to an encounter type
        Institutional claims require bill type and reveue codes.  Professional claims require place of service codes.
      config:
        schema: "{{ var('source_name')}}_{{ var('output_schema')}}"
      tests:
        - unique:
            column_name: "(merge_claim_id || '-' || claim_line_number)"
      columns:
        - name: claim_type
          description:  Overarching claim type.  Valid values are I, P, and DME (institution, profession, and durable medical equipment).
          tests:
            - not_null
            - accepted_values:
                values: ['I','P']
        - name: merge_claim_id
          description:  New claim id generated by hashing original claim id and encounter type.
          tests:
            - not_null
        - name: original_claim_id
          description:  The original claim id.  Current purpose is for troubleshooting
          tests:
            - not_null
        - name: claim_line_number
          description: The claim line number of the claim.  Current purpose is for troubleshooting.  Downstream uses unknown, will likely be removed.
        - name: patient_id
          description:  The unique identifier of a beneficiary
          tests:
            - not_null
        - name: encounter_type
          description:  The encounter type that has been assigned to the claim line item.
          tests:
            - encounter_type_mapping
        - name: claim_start_date
          description:  The start date of the claim
          tests:
            - not_null
        - name: claim_end_date
          description:  The end date of the claim
          tests:
            - not_null
        - name: discharge_disposition_code
          description:  The discharge status of the patient at the end of the claim (01-home, 30-still a patient, etc)
          tests:
            - inst_discharge_disposition_code
            - relationships:
                to: ref('revenue_center_code')
                field: revenue_center_code
                config:
                  severity: warn
        - name: facility_npi
          description:  The facility ID on the claim.  Does not have to be the NPI however it needs to be a consistent ID within the claim to ensure linking/merging.
          tests:
            - inst_bill_type_code
        - name: bill_type_code
          description:  The 3 digit bill type code on the claim.  Should only be on institutional claims.  Facility type (TOB 1) and classification (TOB 2) required for mapping encounter types.  Frequency (TOB 3) not needed and will be ignored.
          tests:
            - inst_bill_type_code
        - name: revenue_center_code
          description:  The 4 digit revenue type code on the claim.  Should only be on institutional claims.  Must be 4 digits including leading zeros.
          tests:
            - inst_revenue_center_code
            - relationships:
                to: ref('revenue_center_code')
                field: revenue_center_code
                config:
                  severity: warn
        - name: place_of_service_code
          description:  The 2 digit place of service code on the claim.  Should only appear on professional claims.  Must be 2 digits including leading zero.
          tests:
            - prof_place_of_service_code
            - relationships:
                to: ref('place_of_service')
                field: place_of_service_code
                config:
                  severity: warn
